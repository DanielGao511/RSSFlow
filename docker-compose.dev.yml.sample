services:
  # 1. RSSHub (保持不变)
  rsshub:
    build: 
      context: ./rsshub
    ports:
      - "1200:1200"
    restart: always
    environment:
      NODE_ENV: dev
      CACHE_TYPE: redis
      REDIS_URL: "redis://redis:6379/"
      CACHE_EXPIRE: 120 # 缓存过期时间，单位秒，生产环境可以适当调长
      # === 推特(X) 配置预留区 ===
      # 如果未来要抓推特，把下面两行前面的 # 去掉，填入你的 Cookie
      # TWITTER_AUTH_TOKEN: '这里填你的auth_token'
      # TWITTER_CT0: '这里填你的ct0'
    depends_on:
      - redis

  # 2. AI Bridge 
  ai-bridge:
    build: 
      context: ./ai-bridge
    ports:
      - "5000:5000" # 暴露出来方便调试
    restart: always
    environment:
      ALIYUN_API_KEY: ${ALIYUN_API_KEY}
      ALIYUN_BASE_URL: ${ALIYUN_BASE_URL}
      REDIS_HOST: redis
    depends_on:
      - redis

  # 3. bot
  bot:
    image: rongronggg9/rss-to-telegram:latest
    volumes:
      - ./bot_data:/app/config
    restart: always
    environment:
      TOKEN: ${TEST_TG_BOT_TOKEN}
      MANAGER: ${MANAGER}
      API_ID: ${API_ID}
      API_HASH: ${API_HASH}
      TELEGRAPH_TOKEN: ${TELEGRAPH_TOKEN}
      RSSHUB_HOST: 'rsshub:1200' 
      HTTP_TIMEOUT: 300
      NO_PROXY: "ai-bridge,rsshub,127.0.0.1,localhost"
      R_PROXY: "http://IPV4:7890"
      HTTP_PROXY: "http://IPV4:7890"
      HTTPS_PROXY: "http://IPV4:7890"
    depends_on:
      - ai-bridge

  # 4. Redis (保持不变)
  redis:
    image: redis:alpine
    volumes:
      - ./redis_data:/data