FROM python:3.9-slim

WORKDIR /app

# å®‰è£…ä¾èµ–
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# å¤åˆ¶é€šè¿‡ä»£ç 
COPY . .

# æš´éœ²ç«¯å£
EXPOSE 5000

# ğŸ‘‡ æ–°å¢è¿™ä¸€è¡Œï¼å¼ºåˆ¶ Python å®æ—¶æ‰“å°æ—¥å¿—ï¼Œä¸è¦ç¼“å†²
ENV PYTHONUNBUFFERED=1

# ã€å…³é”®ä¿®æ”¹ã€‘
# 1. -k gthread: æ”¹ç”¨å¤šçº¿ç¨‹æ¨¡å¼ï¼Œæå…¶ç¨³å®šï¼Œä¸ä¼šè«åå´©æºƒ
# 2. --threads 10: å…è®¸åŒæ—¶å¤„ç† 10 ä¸ªè¯·æ±‚
# 3. --timeout 300: ä¿æŒ 5 åˆ†é’Ÿè¶…æ—¶è€å¿ƒ
CMD ["gunicorn", "-k", "gthread", "--threads", "10", "-w", "1", "-b", "0.0.0.0:5000", "--timeout", "300", "app:app"]